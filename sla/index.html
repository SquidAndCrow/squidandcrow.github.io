<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <title>SLA Calculator</title>
</head>
<body>
  <div class="container">
  <div class="row">
    <div class="col-md-12">
      <h2>SLA Calculator</h2>
      <p>It does the work, so you don't have to try and remember!</p>
      <h4>SLC Calculator</h4>
      <div class="col-md-4"><p>What is your current rank? <input type="text" class="current-rank form-control"></p></div>
      <div class="col-md-4"><p>How much are you adding? <input type="text" class="add-points form-control"></p></div>
      <a href="" class="btn btn-primary calc-sla">Math!</a>
      <div class="col-md-4"><p>Result <input type="text" class="result form-control"></p></div>

    </div>
  </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
  $(document).ready(function(){
    letterArr = [];
    letterArr[0] = 'AA'
    letterArr[1] = 'A';
    letterArr[2] = 'B';
    letterArr[3] = 'C';
    letterArr[4] = 'D';
    letterArr[5] = 'E';
    letterArr[6] = 'F';

    let parseRank = function(str, add) {
      rankArr = str.split('.');
      if(rankArr.length == 1) {
        lastChar = rankArr[0].slice(-1);
        if(isNaN(lastChar)) {
          rankArr[2] = rankArr[0].slice(-1);
          rankArr[1] = 0
          rankArr[0] = parseInt(rankArr[0]);
        } else {
          rankArr[1] = 0;
        }
      } else {
        lastChar = rankArr[1].slice(-1);
        if(isNaN(lastChar)) {
          rankArr[1] = rankArr[1].slice(0,1);
          rankArr[2] = lastChar.toUpperCase();
        }
      }

      let pointsToAdd = add * 10;
      rankArr[1] = parseInt(rankArr[1]) + parseInt(pointsToAdd);

      if(rankArr[1] > 9) {
        let maxLRank = maxLetterRank(rankArr[0]);
        console.log(letterArr.indexOf(rankArr[2]) <  letterArr.indexOf(maxLRank));
        if(letterArr.indexOf(rankArr[2]) < letterArr.indexOf(maxLRank)){
          if(letterArr.indexOf(rankArr[2]) == -1){
            rankArr[2] = letterArr[1];
          } else {
            rankArr[2] = letterArr[letterArr.indexOf(rankArr[2]) + 1];
          }          
        } else {
          rankArr[2] = "";
          rankArr[0] -= 1;
        }
        rankArr[1] -= 10;
      }

      return rankArr;

    }

    let maxLetterRank = function(rank) {
      let maxRank = '';
      if(rank == 10) {
        maxRank = 'A';
      } else if(rank == 9) {
        maxRank = 'B';
      } else if(rank == 8) {
        maxRank = 'C';
      } else if(rank == 7) {
        maxRank = 'D';
      } else if(rank == 6) {
        maxRank = 'E';
      } else {
        maxRank = 'F';
      }
      return maxRank;
    }

    $('.calc-sla').on('click', function(e) {
      e.preventDefault();
      let add = $('.add-points').val();
      let str = parseRank($('.current-rank').val(), add);
      if(str.length == 3) {
        $('.result').val(str[0] + '.' + str[1] + str[2]);
      } else {
        $('.result').val(str[0] + '.' + str[1]);
      }



    })
  });
  </script>
</body>
</html>